<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>icub-basic-demos: demoRedBall</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">icub-basic-demos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">demoRedBall<div class="ingroups"><a class="el" href="group__demo__modules.html">Demo Modules</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The manager module for the Red-Ball Demo developed by IIT and ISR.  
</p>
<p>The manager module for the Red-Ball Demo developed by IIT and ISR. </p>
<p>Copyright (C) 2010 RobotCub Consortium Author: Ugo Pattacini, Alessandro Roncone</p>
<p>CopyPolicy: Released under the terms of the GNU GPL v2.0.</p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>This module collects the 3-d object positions estimated by the particle filter and sends data to the head and arm controllers in order to gaze at the target, reach for it and eventually grasp it. It relies on the YARP ICartesianControl interface to control both arms and on the YARP IGazeControl interface to control the gaze.</p>
<p>Furthermore, there exists a second modality that enables to estimate the 3-d object position using stereo vision that needs to be calibrated in advance relying on a feed-forward neural network.</p>
<p>Finally, a simulation modality is available to run the demo within gazebo.</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<ul>
<li>ctrlLib.</li>
<li>iKin.</li>
<li>YARP libraries.</li>
</ul>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p>None.</p>
<h1><a class="anchor" id="portsa_sec"></a>
Ports Accessed</h1>
<p>The robot interface is assumed to be operative; in particular, the ICartesianControl interface must be available. The iKinGazeCtrl must be running.</p>
<p>In order to run the demo in simulation, such modules can be run with <code>--context gazeboCartesianControl</code>. A template is also available in the folder app/scripts/demoRedBall_gazebo.xml.template.</p>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<ul>
<li><em>/demoRedBall/trackTarget</em>:i receives the 3-d position to track.</li>
<li><em>/demoRedBall/imdTargetLeft</em>:i receives the blobs list as produced by the motionCUT module for the left eye.</li>
<li><em>/demoRedBall/imdTargetRight</em>:i receives the blobs list as produced by the motionCUT module for the right eye.</li>
<li><em>/demoRedBall/cmdFace</em>:o sends out commands to the face expression high level interface in order to give an emotional representation of the current robot state.</li>
<li><em>/demoRedBall/speech</em>:o sends a set of predefined sentences in order for an eventual TTS module to use them during the demo. This feature successfully works with the iSpeak module. The set of predefined sentences to be spoken is defined via .ini file.</li>
<li><em>/demoRedBall/breather/head</em>:rpc interfaces with the head breather (if available) and disables/enables it according when needed</li>
<li><em>/demoRedBall/breather/left_arm</em>:rpc interfaces with the left arm breather (if available) and disables/enables it according when needed</li>
<li><em>/demoRedBall/breather/right_arm</em>:rpc interfaces with the right arm breather (if available) and disables/enables it according when needed</li>
<li><em>/demoRedBall/blinker</em>:rpc interfaces with the iCubBlinker module (if available) and disables/enables it according when needed</li>
<li><em>/demoRedBall/lookSkin</em>:rpc interfaces with the lookSkin module (if available) and disables/enables it according when needed</li>
<li><em>/demoRedBall/gui</em>:o sends out info to update target within the icub_gui</li>
<li><em>/demoRedBall/gazebo</em>:o interfaces with the ball model in gazebo</li>
<li><em>/demoRedBall/rpc</em> remote procedure call. Recognized remote commands: -'quit' quit the module</li>
</ul>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="out_data_sec"></a>
Output Data Files</h1>
<p>None. </p>
<h1><a class="anchor" id="conf_file_sec"></a>
Configuration Files</h1>
<p>The configuration file passed through the option <em>&ndash;from</em> should look like as follows: </p><div class="fragment"><div class="line">[general]</div>
<div class="line"><span class="comment">// the robot name to connect to</span></div>
<div class="line">robot           icub</div>
<div class="line"><span class="comment">// the thread period [ms]</span></div>
<div class="line">thread_period   30</div>
<div class="line"><span class="comment">// left arm switch</span></div>
<div class="line">left_arm        on</div>
<div class="line"><span class="comment">// right arm switch</span></div>
<div class="line">right_arm       on</div>
<div class="line"><span class="comment">// arm trajectory execution time [s]</span></div>
<div class="line">traj_time       2.0</div>
<div class="line"><span class="comment">// reaching tolerance [m]</span></div>
<div class="line">reach_tol       0.01</div>
<div class="line"><span class="comment">// eye used</span></div>
<div class="line">eye             left</div>
<div class="line"><span class="comment">// homes limbs if target detection timeout expires [s]</span></div>
<div class="line">idle_tmo        5.0</div>
<div class="line"><span class="comment">// enable the use of stereo vision calibrated by NN</span></div>
<div class="line">use_network off</div>
<div class="line"><span class="comment">// NN configuration file</span></div>
<div class="line">network         network.ini</div>
<div class="line"><span class="comment">// enable the use of speech</span></div>
<div class="line">speech          on</div>
<div class="line"><span class="comment">// enable the simulation</span></div>
<div class="line">simulation      off</div>
<div class="line"> </div>
<div class="line">[torso]</div>
<div class="line"><span class="comment">// joint switch (min **) (max **) [deg]; &#39;min&#39;, &#39;max&#39; optional</span></div>
<div class="line">pitch on  (max 30.0)</div>
<div class="line">roll off</div>
<div class="line">yaw on</div>
<div class="line"> </div>
<div class="line">[left_arm]</div>
<div class="line"><span class="comment">// enable/disable the grasp</span></div>
<div class="line">grasp_enable        on</div>
<div class="line"><span class="comment">// the offset [m] to be added to the desired position</span></div>
<div class="line">reach_offset        0.0 -0.15 -0.05</div>
<div class="line"><span class="comment">// the offset [m] for grasping</span></div>
<div class="line">grasp_offset        0.0 0.0 -0.05</div>
<div class="line"><span class="comment">// hand orientation to be kept [axis-angle rep.]</span></div>
<div class="line">hand_orientation 0.064485 0.707066 0.704201 3.140572</div>
<div class="line"><span class="comment">// enable impedance velocity mode</span></div>
<div class="line">impedance_velocity_mode off</div>
<div class="line">impedance_stiffness 0.5 0.5 0.5 0.2 0.1</div>
<div class="line">impedance_damping 60.0 60.0 60.0 20.0 0.0</div>
<div class="line"> </div>
<div class="line">[right_arm]</div>
<div class="line">grasp_enable        on</div>
<div class="line">reach_offset        0.0 0.15 -0.05</div>
<div class="line">grasp_offset        0.0 0.0 -0.05</div>
<div class="line">hand_orientation    -0.012968 -0.721210 0.692595 2.917075</div>
<div class="line">impedance_velocity_mode off</div>
<div class="line">impedance_stiffness 0.5 0.5 0.5 0.2 0.1</div>
<div class="line">impedance_damping 60.0 60.0 60.0 20.0 0.0</div>
<div class="line">[home_arm]</div>
<div class="line"><span class="comment">// home position [deg]</span></div>
<div class="line">poss    -30.0 30.0 0.0  45.0 0.0  0.0  0.0</div>
<div class="line"><span class="comment">// velocities to reach home positions [deg/s]</span></div>
<div class="line">vels    10.0  10.0 10.0 10.0 10.0 10.0 10.0</div>
<div class="line"> </div>
<div class="line">[arm_selection]</div>
<div class="line"><span class="comment">// hysteresis range added around plane y=0 [m]</span></div>
<div class="line">hysteresis_thres 0.1</div>
<div class="line"> </div>
<div class="line">[grasp]</div>
<div class="line"><span class="comment">// ball radius [m] for still target detection</span></div>
<div class="line">sphere_radius   0.05</div>
<div class="line"><span class="comment">// timeout [s] for still target detection</span></div>
<div class="line">sphere_tmo      3.0</div>
<div class="line"><span class="comment">// timeout [s] to open hand after closure</span></div>
<div class="line">release_tmo     3.0</div>
<div class="line"><span class="comment">// open hand positions [deg]</span></div>
<div class="line">open_hand       0.0 0.0 0.0   0.0   0.0 0.0 0.0   0.0   0.0</div>
<div class="line"><span class="comment">// close hand positions [deg]</span></div>
<div class="line">close_hand      0.0 80.0 12.0 18.0 27.0 50.0 20.0  50.0 135.0</div>
<div class="line"><span class="comment">// velocities to reach hand positions [deg/s]</span></div>
<div class="line">vels_hand       10.0 10.0  10.0 10.0 10.0 10.0 10.0 10.0  10.0</div>
<div class="line"> </div>
<div class="line">[include speech <span class="stringliteral">&quot;speech_English.ini&quot;</span>]</div>
</div><!-- fragment --><p>The latter inclusion is the .ini file needed for the predefined set of sentences to be spoken. The speech during the red ball demo is divided into three states:</p><ul>
<li>[speech_reach] -&gt; it is used when the robot "sees" the ball, and is trying to reach it</li>
<li>[speech_grasp] -&gt; is performed after the grasping action (regardless of its success/failure)</li>
<li>[speech_idle] -&gt; is used after the red ball is pulled away from the robot's sight For each of these states, there is a group in the .ini file. Each line is a sentence that will be spoken by the robot according to its state. Add as many sentences (i.e. lines) as you'd like to these groups: they will be chosen randomly by the manager at runtime. The speech file should look as follows: <div class="fragment"><div class="line">[speech_reach]</div>
<div class="line"><span class="stringliteral">&quot;Oh.! There it is!!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Stay still, otherwise I can&#39;t catch it!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Give me the red ball!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Red ball is my precious... Give it to me!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Wait!! I want that ball!&quot;</span></div>
<div class="line"> </div>
<div class="line">[speech_grasp]</div>
<div class="line"><span class="stringliteral">&quot;Thank you dear&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Did I take it?&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;I like playing with the red ball!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Yippi ka yeah!&quot;</span></div>
<div class="line"> </div>
<div class="line">[speech_idle]</div>
<div class="line"><span class="stringliteral">&quot;Oh no! I want to play with the red ball again!&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;I want the red ball to be my wife&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Playing with the red ball makes me happy, let&#39;s do it again.&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;I don&#39;t feel tired, let&#39;s play again.&quot;</span></div>
<div class="line"><span class="stringliteral">&quot;Oh my Gosh!! Where&#39;s the red ball??&quot;</span></div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="commands_sec"></a>
Available commands</h1>
<p>To run the demo in gazebo, the following commands can be used:</p>
<ul>
<li><code>start</code> [azi ele ver]: to start the demo; optionally, one can provide the position where the robot initially needs to gaze at.</li>
<li><code>stop</code>: to stop the demo</li>
<li><code>update_pose dx dy dz</code>: to update the ball position with respect to the initial position defined in the world.</li>
</ul>
<p>Note that on the real robot the demo automatically starts.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Windows, Linux</p>
<dl class="section author"><dt>Author</dt><dd>Ugo Pattacini, Alessandro Roncone </dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
